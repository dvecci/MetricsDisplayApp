define(["require","Views/AppView","Collections/UserCollection"],function(e){"use strict";var t=e("Views/AppView"),n=e("Collections/UserCollection"),r=function(e,r,i){var s=this;s.userCollection=new n,s.userMetrics={},s.loaded=$.Deferred();var o=$.getJSON(e);$.when(o).done(function(e){$(e).each(function(){s.userCollection.add(this)});var n=new t({collection:s.userCollection});$(document).ready(function(){i.append(n.$el)})});var u=$.getJSON(r);$.when(u).done(function(e){$(e).each(function(){var e=this,t=e.user_id;s.userMetrics[t]||(s.userMetrics[t]={impressions:0,conversions:0,conversionData:null,revenue:0});var n=s.userMetrics[t];switch(e.type){case"impression":n.impressions++;break;case"conversion":n.conversions++,n.revenue+=e.revenue;var r=new Date(e.time.substring(0,10));n.conversionData&&n.conversionData[r]?n.conversionData[r]++:(n.conversionData||(n.conversionData={}),n.conversionData[r]=1);break;default:}}),s.userCollection.each(function(e){var t=s.userMetrics[e.id];e.set("conversionData",t.conversionData),e.set("conversions",t.conversions),e.set("impressions",t.impressions),e.set("revenue",t.revenue)})}),$.when(o,u).then(function(){s.loaded.resolve()})};return r});